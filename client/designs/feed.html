<!DOCTYPE html>
<html>

<head>
  <title>Flitter</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.3.1/css/foundation.min.css">
  <script src="https://unpkg.com/react@15.3.2/dist/react.js"></script>
  <script src="https://unpkg.com/react-dom@15.3.2/dist/react-dom.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
  <script src="https://unpkg.com/react-router/umd/react-router.min.js"></script>
  <script src="https://unpkg.com/react-router-dom/umd/react-router-dom.min.js"></script>
</head>

<body>
  <div id="container"></div>

  <script type="text/babel">
    var { BrowserRouter, Route, link } = window.ReactRouterDOM;

    var destination = document.querySelector('#container');

    var Header = React.createClass({
      render: function() {
        var anchorStyle = {
          color: 'inherit'
        };

        var headerStyle = {
          backgroundImage: 'url(header.jpg)',
	        backgroundSize: '100%',
          color: 'white'
        };

        var listItemStyle = {
          display: 'inline',
          margin: '0 5px'
        };

        var listStyle = {
          listStyleType: 'none'
        };

        return (
          <div style={headerStyle}>
            <div className="row">
              <div className="small-9 columns">
                <h3>Flitter</h3>
              </div>

              <div className="small-3 columns">
                <ul style={listStyle}>
                  <li style={listItemStyle}><a style={anchorStyle}>Feed</a></li>
                  <li style={listItemStyle}><a style={anchorStyle}>Hashtags</a></li>
                  <li style={listItemStyle}><a style={anchorStyle}>About</a></li>
                </ul>
              </div>
            </div>
          </div>
        );
      }
    });

    var Tweet = React.createClass({
      render: function() {
        var tweetStyle = {
          width: 500,
          backgroundColor: 'white',
          borderStyle: 'solid',
          borderWidth: 1,
          padding: '5px 0px'
        };

        return (
          <div style={tweetStyle} className="float-center">
            <h5>{this.props.fullname}</h5>
            <p><a href={'user.html?uname=' + this.props.uname}>@{this.props.uname}</a></p>
            <p>{this.props.timestamp}</p>
            <p>{this.props.content}</p>
          </div>
        );
      }
    });

    var Feed = React.createClass({
      getInitialState() {
        return {
          tweets: []
        };
      },
      componentDidMount() {
        this.TweetList();
      },
      TweetList() {
        var url = 'http://localhost:8000/api/tweet';

        if (this.props.params.user) {
          url += '/' + this.props.params.user;
        }

        return fetch(url)
          .then(response => response.json())
          .then(json => {
            this.setState({ tweets: json });
          });
      },
      render: function() {
        const tweets = this.state.tweets.map((tweet, i) => {
          return ( 
            <Tweet key={i + tweet.content} fullname={tweet.fullname} uname={tweet.uname} timestamp={tweet.timestamp} content={tweet.content}/>
          );
        });

        return (
          <div>
            {tweets}
          </div>
        );
      }
    });

    var Body = React.createClass({
      render: function() {
        var bodyStyle = {
          backgroundImage: 'url(body.jpg)',
	        backgroundSize: '100%'
        };

        return (
          <div style={bodyStyle}>
            <Feed/>
          </div>
        );
      }
    });

    ReactDOM.render(
      <BrowserRouter>
        <Route path='/' component={Header}/>
        <Route exact path='/' component={Feed}/>
        <Route path='/:user' component={Feed}/>
      </BrowserRouter>,
      destination
    );
  </script>
</body>

</html>